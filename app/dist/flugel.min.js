!function(){"use strict";angular.module("flugel",["ngRoute","ngMaterial","ngCookies","flugel.themes","flugel.services","flugel.views","flugel.components"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(e){e.interceptors.push(["$cookies","$location","$q",function(e,t,n){return{request:function(t){return e.get("session")&&(t.headers.authorization=e.get("session")),t}}}])}])}(),angular.module("flugel.components",["flugel.components.keyboard","flugel.components.tokenScreen","flugel.components.longpress","flugel.components.tokenManagement","flugel.components.manageServices","flugel.components.selectionRole","flugel.components.charts","flugel.components.sidenav","flugel.components.gtr"]),angular.module("flugel.views",["flugel.view1","flugel.view2","flugel.views.selectionRole","flugel.views.dash"]),function(){"use strict";angular.module("flugel.themes",[]).config(["$mdThemingProvider",function(e){e.definePalette("amazingPaletteName",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"fafafa",500:"fafafa",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),e.theme("docs-dark","default").primaryPalette("amazingPaletteName").dark()}])}(),angular.module("flugel.components.charts",["flugel.components.charts.bar","flugel.components.charts.pie","flugel.components.charts.line"]),angular.module("flugel.components.gtr",["flugel.components.gtr.activityAdviser","flugel.components.gtr.header"]),function(){"use strict";function e(){return{retrict:"E",scope:{keyboardNumber:"=keyboardnumber"},controller:t,templateUrl:"src/components/keyboard/keyboard.html"}}function t(e,t,n,o){var i=10,c=4;e.keyboard="",e.keyboardNumber="",e.addNumber=function(t){e.keyboardNumber=e.keyboardNumber+t},e.setNumber=function(){e.keyboard=e.keyboardNumber,e.keyboard.length>=c&&e.keyboard.length<=i?o.$broadcast("submitKeyboard",e.keyboard):alert("No es un número válido")},e.clearKeyboard=function(){e.keyboardNumber=e.keyboardNumber.slice(0,-1)}}angular.module("flugel.components.keyboard",[]).directive("fgKeyboard",e),t.$inject=["$scope","$element","$attrs","$rootScope"]}(),function(){"use strict";function e(){return{retrict:"A",controller:t,scope:{}}}function t(e,t,n,o,i){var c=null;e.message="Don't press me to hard",console.log(e.message),t.bind("mousedown",function(t){c=i(function(){e.message="Ouch",console.log("long press")},1e3)}),t.bind("mouseup",function(e){c=null})}angular.module("flugel.components.longpress",[]).directive("fgLongpress",e),t.$inject=["$scope","$element","$attrs","$rootScope","$timeout"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,controllerAs:"demo",templateUrl:"src/components/manageServices/manageServices.html"}}function t(e,t,n,o,i,c,r){var a=this;a.services=[],e.selectedService="",console.log(n),o.services.query(function(e){a.services=e,console.log(e)}),e.cancel=function(){i.cancel()},e.choosePurposeVisit=function(t,n){console.log(n),e.selectedService=n._id},e.goBackStep=function(){e.selectedService="",e.searchText=""},e.insertService=function(e,t){e.service.subServices=[t],console.log(e.service)}}angular.module("flugel.components.manageServices",[]).directive("fgManageServices",e),t.$inject=["$scope","$element","$attrs","Token","$mdDialog","Config","socket"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,templateUrl:"src/components/selectionRole/selectionRole.html"}}function t(e,t,n,o,i,c,r){function a(e){var t=_.last(e.activity).role.code;return"0"===t?void(c.location="#/view1"):void(c.location="#/view2")}var l,s={};e.data={},e.activity={},o.login.get(function(t){return t.login?(e.branchOffices=t.userData.circleList.branchOffices,l=t.userData,s={adviserName:l.name,adviserLastName:l.lastName,adviserId:l.idUser,adviserEmail:l.email},i.activity.get(s,function(t){if(t._id){e.activity=t;var n=_.last(t.activity),o=n.activityEvent.eventCode;return"10"!==o?"0"===n.role.code?void(c.location="#/view1"):void(c.location="#/view2"):(e.data.role=n.role.code,e.data.branchOffice=n.branchOffice.posCode,e.data.terminal=n.branchOffice.terminal.terminalId,console.log(e.data),void 0)}}),void 0):void(c.location="/login")}),e.roles=[{code:"0",name:"Orientador"},{code:"1",name:"Servicio"},{code:"2",name:"Venta"}],e.terminals=[{terminalId:"1",terminalName:"Terminal 1"},{terminalId:"2",terminalName:"Terminal 2"},{terminalId:"3",terminalName:"Terminal 3"},{terminalId:"4",terminalName:"Terminal 4"},{terminalId:"5",terminalName:"Terminal 5"},{terminalId:"6",terminalName:"Terminal 6"}],e.setConfData=function(){if(console.log(e.branchOffices),!e.branchOffices)return console.log("closed");var t=_.clone(_.findWhere(e.branchOffices,{posCode:e.data.branchOffice}));t.blueCircle=t.blueCircles[0],t.terminal=_.findWhere(e.terminals,{terminalId:e.data.terminal}),delete t.blueCircles;var n=_.findWhere(e.roles,{code:e.data.role});if(s.role=n,s.branchOffice=t,_.size(e.activity)){var o={idActivity:e.activity._id,eventCode:"10",eventName:"closed"};o.terminal=t.terminal,o.role=n,i.activity.update(o,function(t){e.activity=t,r.emit("selectionRole"),a(t)})}else i.activity.save(s,function(t){console.log(t),e.activity=t,a(t)},function(e){console.log(e)})}}angular.module("flugel.components.selectionRole",[]).directive("fgSelectionRole",e),t.$inject=["$scope","$element","$attrs","Login","Activity","$window","socket"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,templateUrl:"src/components/sidenav/sidenav.html"}}function t(e,t,n){}angular.module("flugel.components.sidenav",[]).directive("fgSidenav",e),t.$inject=["$scope","$element","$attrs"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,controllerAs:"demo",templateUrl:"src/components/tokenManagement/tokenManagement.html"}}function t(e,t,n,o,i,c,r,a,l,s,u,d){function f(){m(function(){v()})}function m(t){s.login.get(function(n){n.login&&(L=n.userData.circleList.branchOffices[0].posCode,g(L),j={adviserName:n.userData.name,adviserLastName:n.userData.lastName,adviserId:n.userData.idUser,adviserEmail:n.userData.email},u.activity.get(j,function(n){return e.activity=n,t()}))})}function v(){a.tokens.query({state:2},function(t){return t.length&&(E.tokenInAttention=_.find(t,function(e){return e.token.receiverAdviser.adviserId===j.adviserId})||{},console.log(E.tokenInAttention),_.size(E.tokenInAttention))?(E.stateAttention=2,e.waitTime=p(E.tokenInAttention.token.infoToken.logCreationToken,E.tokenInAttention.token.infoToken.logCalledToken),e.callTime=p(E.tokenInAttention.token.infoToken.logCalledToken,E.tokenInAttention.token.infoToken.logAtentionToken),void(U=o(k,200,!1))):void y()})}function g(){d.on("newToken",function(e){console.log(e),0===E.stateAttention&&j.adviserId===e.availableUser.adviserId&&$(e.token)}),d.on("resultService",function(e){E.tokenInAttention=e,i.hide()})}function k(){e.attentionTime=p(E.tokenInAttention.token.infoToken.logAtentionToken,!1)}function p(e,t){var n=e?moment(e):moment(),o=t?moment(t):moment();return moment.utc(o.diff(n)).format("HH:mm:ss")}function h(){E.stateAttention=0,E.tokenToBeTaken={},E.tokenInAttention={},T("3","available",function(t){var n=_.last(e.activity.activity).activityStartTime;o.cancel(O),O=o(function(){e.availableTime=p(n,!1)},200,!1)})}function T(t,n,o){if(!e.activity._id)return void(r.location="#/select");var i=_.last(e.activity.activity).activityEvent.eventCode;if(i!==t){var c={idActivity:e.activity._id,eventCode:t,eventName:n};u.activity.update(c,function(t){return e.activity=t,o?o(t):void 0})}return o?o(null):void 0}function y(){a.tokens.query({state:0,room:L},function(e){return e.length?$(e[0]):void h()})}function $(t){function n(t){E.stateAttention=1,E.tokenToBeTaken=t.token,E.tokenToBeTaken.id=t._id,R=o(function(){e.callTime=p(t.token.infoToken.logCalledToken,!1),e.callTime[4]>=2&&a.abandoningToken.update({id:t._id},function(e){o.cancel(R),y()})},200,!1)}o.cancel(O);var i={id:t._id};t.token.infoToken.logCalledToken?n(t):a.callToken.update(i,function(e){T("1","callToken"),n(e)})}function b(){var t={id:E.tokenToBeTaken.id};console.log(j),a.takeToken.update(t,j,function(t){T("2","attendToken"),E.stateAttention=2,E.tokenInAttention=t,e.waitTime=p(E.tokenInAttention.token.infoToken.logCreationToken,E.tokenInAttention.token.infoToken.logCalledToken),e.callTime=p(E.tokenInAttention.token.infoToken.logCalledToken,E.tokenInAttention.token.infoToken.logAtentionToken),U=o(k,200),o.cancel(R),S()})}function C(){var e=i.confirm().title("¿Desea teminar el turno?").ariaLabel("End token").ok("Terminar").cancel("Continuar");i.show(e).then(function(){var e={id:E.tokenInAttention._id};console.log(e),a.closeToken.update(e,function(e){o.cancel(U),y()})},function(){})}function w(e){0===e?I():2===e&&C()}function A(e,t,n){t=t||function(){return void 0},n=n||function(){return void 0},i.show({controller:P,controllerAs:"demo",templateUrl:"src/components/tokenManagement/serviceList.html",parent:angular.element(document.body),clickOutsideToClose:!1,targetEvent:null,locals:e}).then(t,n)}function I(){var e={tokenData:{token:E.tokenInAttention},mode:"insert"};A(e)}function S(){var e={tokenData:{token:E.tokenInAttention},mode:"initInsert"};A(e)}function N(t,n){function o(){e.visibleTooltip=!0}e.visibleTooltip=!1;var i={tokenData:{token:E.tokenInAttention,service:n},mode:"edit"};A(i,o)}function D(){T("10","closed",function(e){d.emit("closeAttention"),r.location="#/select"})}function P(e,t,n,o,i,c,r){var a=this;a.services=[],a.mode=c,e.selectedService="","edit"===c?e.selectedService=i.service.serviceId:"insert"===c?(e.selectedService="",console.log(i.token.token.motivoVisita)):"initInsert"===c&&(e.selectedService=i.token.token.motivoVisita.serviceId),t.services.query(function(e){a.services=e}),e.cancel=function(){n.cancel()},e.choosePurposeVisit=function(t,n){e.selectedService=n.service.serviceId},e.goBackStep=function(){e.selectedService="",e.searchText=""},e.insertService=function(e,t){var n=_.clone(e.service);n.subServices=[t],"insert"===c||"initInsert"===c?r.emit("insertService",{id:i.token._id,service:n}):"edit"===c&&r.emit("updateSubservice",{idToken:i.token._id,idService:i.service._id,subServices:n.subServices})}}var U,R,O,L,j={},E=this;E.hidden=!1,E.direction="up",E.onlyRead="true"===n.onlyRead?!0:!1,E.stateAttention=0,E.tokenToBeTaken={},E.tokenInAttention={},E.items=[{name:"Nuevo servicio",icon:"fa-plus",direction:"left"},{name:"Tranferir turno",icon:"fa-exchange",direction:"left"},{name:"Terminar turno",icon:"fa-power-off",direction:"left",btnColor:"md-warn"}],e.attentionTime="00:00:00",e.waitTime="00:00:00",e.callTime="00:00:00",e.availableTime="00:00:00",e.stateName=["Disponible","Llamando..."],e.visibleTooltip=!0,e.activity={},e.takeToken=b,e.tokenAction=w,e.editService=N,e.closeAttention=D,f(),P.$inject=["$scope","Token","$mdDialog","Config","tokenData","mode","socket"]}angular.module("flugel.components.tokenManagement",[]).directive("fgTokenManagement",e),t.$inject=["$scope","$element","$attrs","$interval","$mdDialog","$cookies","$window","Token","Config","Login","Activity","socket"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,templateUrl:"src/components/tokenScreen/tokenScreen.html"}}function t(e,t,n,o,i,c){e.pendingTokens=[],o.tokens.query({state:0},function(t){e.pendingTokens=t,console.log(t)}),c.on("newToken",function(t){console.log(t),o.tokens.query({state:0},function(t){e.pendingTokens=t})}),c.on("takeToken",function(){o.tokens.query({state:0},function(t){e.pendingTokens=t})})}angular.module("flugel.components.tokenScreen",[]).directive("fgTokenScreen",e),t.$inject=["$scope","$element","$attrs","Token","Config","socket"]}(),function(){"use strict";angular.module("flugel.views.dash",["ngRoute"]).config(["$routeProvider",function(e){e.when("/dash",{templateUrl:"src/views/dashView/dash.html",controller:"dashCtrl"})}]).controller("dashCtrl",["$scope","Login","$window","$cookies","$mdSidenav",function(e,t,n,o,i){e.close=function(){i("left").toggle().then(function(){console.log("close RIGHT is done")})}}])}(),function(){"use strict";angular.module("flugel.views.selectionRole",["ngRoute"]).config(["$routeProvider",function(e){e.when("/select",{templateUrl:"src/views/selectionRoleView/selectionRole.html",controller:"selectionRoleCtrl"})}]).controller("selectionRoleCtrl",["$scope","Login","$window","$cookies",function(e,t,n,o){t.login.get(function(e){e.login||(n.location="/login")}),e.logout=function(e){e.preventDefault(),t.logout.save(function(e){o.remove("session"),e.login||(n.location="/login")})}}])}(),function(){"use strict";function e(e,n,o,i,c,r,a,l,s){function u(){h.step=1,h.dataCustomer={service:"",token:{lineNumber:"",screenName:""}},e.keyboardNumber=""}function d(e){h.step=e}function f(e){h.dataCustomer.token.lineNumber=e,h.step=2}function m(){h.step=3}function v(o,i){h.dataCustomer.service=i,n.show({controller:t,templateUrl:"src/views/tokenGenerationView/dialog.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!1,locals:{dataCustomer:h.dataCustomer,branchOffice:_.last(e.activity.activity).branchOffice}}).then(function(t){e.status='You said the information was "'+t+'".',console.log(e.status),u()},function(){e.status="You cancelled the dialog.",console.log(e.status)})}function g(){a.login.get(function(t){t.login?(console.log(t.userData),h.dataCustomer.token.adviserName=t.userData.name,h.dataCustomer.token.adviserLastName=t.userData.lastName,h.dataCustomer.token.adviserId=t.userData.idUser,h.dataCustomer.token.adviserEmail=t.userData.email,r.activity.get(h.dataCustomer.token,function(t){e.activity=t,k("0","generateToken")})):o.location="/login"})}function k(t,n,i){if(!e.activity._id)return void(o.location="#/select");var c=_.last(e.activity.activity).activityEvent.eventCode;if(c!==t){var a={idActivity:e.activity._id,eventCode:t,eventName:n};r.activity.update(a,function(t){return e.activity=t,i?i(t):void 0})}return i?i(null):void 0}function p(){k("10","closed",function(e){s.emit("closeAttention"),o.location="#/select"})}var h=this;h.services=[],u(),e.activity={},e.start=u,e.goBackStep=d,e.nextToDigitName=f,e.digitName=m,e.choosePurposeVisit=v,e.closeAttention=p,e.$on("submitKeyboard",function(e,t){f(t)}),g(),s.on("connect",function(){s.emit("session",{idSession:i.get("session")})}),c.services.query(function(e){h.services=e,console.log(e)})}function t(e,t,n,o,i){n.token.numerator=n.service.service.numerator,n.token.motivoVisita=n.service.service.serviceName,n.token.posCode=o.posCode,n.token.branchOffice=o,n.token.service={serviceName:n.service.service.serviceName,serviceId:n.service.service.serviceId},e.dataCustomer=n,e.showTokenResult=!1,e.tokenGeneration=function(){console.log(e.dataCustomer),i.tokens.save(e.dataCustomer.token,function(t){console.log(t.token),e.generatedToken=t.token.token,e.showTokenResult=!0},function(e){console.log(e)})},e.closeDialog=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)}}angular.module("flugel.view1",["ngRoute"]).config(["$routeProvider",function(e){e.when("/view1",{templateUrl:"src/views/tokenGenerationView/tokenGeneration.html",controllerAs:"vc1",controller:"TokenGenerationCtrl"})}]).controller("TokenGenerationCtrl",e).controller("DialogCtrl",t),e.$inject=["$scope","$mdDialog","$window","$cookies","Token","Activity","Login","Config","socket"],t.$inject=["$scope","$mdDialog","dataCustomer","branchOffice","Token"]}(),function(){"use strict";angular.module("flugel.view2",["ngRoute"]).config(["$routeProvider",function(e){e.when("/view2",{templateUrl:"src/views/view2/view2.html",controller:"View2Ctrl"})}]).controller("View2Ctrl",["$scope","Login","$window","$cookies",function(e,t,n,o){t.login.get(function(e){console.log(e),e.login||(n.location="/login")}),e.logout=function(e){e.preventDefault(),t.logout.save(function(e){o.remove("session"),e.login||(n.location="/login")})}}])}(),function(){"use strict";angular.module("flugel.services",["ngResource"]).factory("Config",function(){return{version:"0.0.1",ip:location.hostname,port:3001,protocol:"http"}}).factory("Token",["$resource","Config",function(e,t){return{services:e("http://"+t.ip+":"+t.port+"/services"),tokens:e("http://"+t.ip+":"+t.port+"/tokens"),callToken:e("http://"+t.ip+":"+t.port+"/callToken",{},{update:{method:"PUT"}}),takeToken:e("http://"+t.ip+":"+t.port+"/takeToken",{},{update:{method:"PUT"}}),closeToken:e("http://"+t.ip+":"+t.port+"/closeToken",{},{update:{method:"PUT"}}),abandoningToken:e("http://"+t.ip+":"+t.port+"/abandoningToken",{},{update:{method:"PUT"}})}}]).factory("Login",["$resource","Config",function(e,t){return{login:e("http://"+t.ip+":"+t.port+"/user/login.json",{},{update:{method:"PUT"}}),logout:e("http://"+t.ip+":"+t.port+"/user/logout.json",{},{update:{method:"PUT"}})}}]).factory("Activity",["$resource","Config",function(e,t){return{activity:e("http://"+t.ip+":"+t.port+"/activity",{},{update:{method:"PUT"}})}}]).factory("socket",["$rootScope","Config",function(e,t){var n=io(t.protocol+"://"+t.ip+":"+t.port);return{on:function(t,o){n.on(t,function(){var t=arguments;e.$apply(function(){o.apply(n,t)})})},emit:function(t,o,i){n.emit(t,o,function(){var t=arguments;e.$apply(function(){i&&i.apply(n,t)})})}}}])}(),function(){"use strict";function e(){return{retrict:"A",scope:{},controller:t,template:'<div class="ct-chart" id="{{barId}}"></div>'}}function t(e,t,n){e.barId=n.id;var o={labels:["Disponible","Ocupado","Breack","Alm","Cap"],series:[[50,14,32,7,5]]},i={seriesBarDistance:2},c=[["screen and (max-width: 640px)",{seriesBarDistance:5,axisX:{labelInterpolationFnc:function(e){return e[0]}}}]];new Chartist.Bar("#"+n.id,o,i,c).on("draw",function(e){"bar"===e.type&&e.element.attr({style:"stroke-width: "+n.ancho})})}angular.module("flugel.components.charts.bar",[]).directive("fgChartBar",e),t.$inject=["$scope","$element","$attrs"]}(),function(){"use strict";function e(){return{retrict:"A",scope:{},controller:t,template:'<div class="ct-chart" id="{{lineId}}"></div>'}}function t(e,t,n){var o={labels:["8:00","8:30","9:00","9:30","10:00","10:30"],series:[{name:"NS",data:[100,60,83,75,90,88]},{name:"NS Acumulado",data:[100,83,85,70,60,86]}]};e.lineId=n.id,new Chartist.Line("#"+n.id,o)}angular.module("flugel.components.charts.line",[]).directive("fgChartLine",e),t.$inject=["$scope","$element","$attrs"]}(),function(){"use strict";function e(){return{retrict:"A",scope:{},controller:t,template:'<div class="ct-chart" id="{{pieId}}"></div>'}}function t(e,t,n){e.pieId=n.id;var o={labels:["Bananas","Apples","Grapes"],series:[20,15,40]},i={labelInterpolationFnc:function(e){return e[0]}},c=[["screen and (min-width: 640px)",{chartPadding:30,labelOffset:100,labelDirection:"explode",labelInterpolationFnc:function(e){return e}}],["screen and (min-width: 1024px)",{labelOffset:80,chartPadding:20}]];new Chartist.Pie("#"+n.id,o,i,c)}angular.module("flugel.components.charts.pie",[]).directive("fgChartPie",e),t.$inject=["$scope","$element","$attrs"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,templateUrl:"src/components/gtr/activityAdviser/activityAdviser.html"}}function t(e,t,n){}angular.module("flugel.components.gtr.activityAdviser",[]).directive("fgActivityAdviser",e),t.$inject=["$scope","$element","$attrs"]}(),function(){"use strict";function e(){return{retrict:"E",scope:{},controller:t,templateUrl:"src/components/gtr/header/header.html"}}function t(e,t,n){}angular.module("flugel.components.gtr.header",[]).directive("fgHeader",e),t.$inject=["$scope","$element","$attrs"]}();